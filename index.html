<!DOCTYPE html>
<html lang="ru" data-theme="glow">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ryazhenka CFW — Nintendo Switch Custom Firmware</title>
  <meta name="description" content="Ryazhenka — стабильная кастомная прошивка для Nintendo Switch. Glow/terminal стиль, crew-экосистема, релизы и документация." />
  <link rel="icon" href="./assets/Ryazhalogo.png" />
  <link rel="stylesheet" href="./styles/style.css" />
  <script defer src="./scripts/main.js"></script>
  <style>
    /* Небольшие локальные правки для сетки/блоков, если основной CSS не содержит */
    .releases { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); gap: 1rem; margin-top: 1rem; }
    .release-card { background: var(--panel-bg, #0b0b0b); padding: 1rem; border-radius: 8px; display:flex; flex-direction:column; gap:0.5rem; min-height:160px; }
    .release-card img { width:100%; height:120px; object-fit:contain; background:#000; border-radius:6px; }
    .release-card .meta { display:flex; justify-content:space-between; gap:0.5rem; font-size:0.85rem; color:var(--muted,#9aa0a6); }
    .release-card .assets { display:flex; flex-direction:column; gap:0.25rem; margin-top:0.25rem; }
    .release-card .asset { display:flex; gap:.5rem; align-items:center; font-size:0.9rem; flex-wrap:wrap; }
    .crew-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(180px,1fr)); gap:1rem; margin-top:1rem; }
    .crew-card { display:flex; gap:.5rem; align-items:center; padding:.5rem; background:var(--panel-bg,#0b0b0b); border-radius:6px; }
    .crew-card img { width:48px; height:48px; border-radius:6px; object-fit:cover; }
    .terminal-block { background:#071018; color:#bfe9ff; padding:1rem; border-radius:6px; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Segoe UI Mono", monospace; }
    .roadmap { display:flex; flex-direction:column; gap:.5rem; }
    .components { display:grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap:1rem; }
    .comp img { width:64px; height:64px; object-fit:contain; border-radius:8px; }
    .top .badges { display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; }
    .social-row { display:flex; gap:.5rem; margin-top:.5rem; flex-wrap:wrap; }
    .toggle { cursor:pointer; user-select:none; display:inline-flex; align-items:center; gap:0.5rem; padding:0.25rem 0.5rem; border-radius:999px; background:rgba(255,255,255,0.02); }
  </style>
</head>
<body>
  <header class="top">
    <div class="wrap brand">
      <div class="brand-left">
        <img alt="Ryazhenka" class="logo" src="./assets/Ryazhalogo.png" onclick="location.href='./'" />
        <div class="title glow">Ryazhenka CFW</div>
        <div class="muted" style="font-size:0.9rem; margin-top:4px;">Ряженка — кастомная прошивка для Nintendo Switch, экипажные настройки, максимальная стабильность, терминальный визуал</div>
      </div>
      <div class="badges">
        <div class="social-row">
          <a class="badge" href="https://t.me/Ryazhenkabestcfw" target="_blank">Telegram</a>
          <a class="badge" href="https://boosty.to/dimasick-git/donate" target="_blank">Boosty</a>
          <a class="badge" href="https://www.youtube.com/@Dimaick-git" target="_blank">YouTube</a>
        </div>
        <div class="toggle" id="themeToggle" title="Glow ↔ Classic Terminal">
          Glow <div class="switch" id="themeSwitch" style="margin:0 8px;"><span class="thumb"></span></div> Classic
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- 1. Баннеp экипажа и философия -->
    <section class="panel" id="crew-banner">
      <div class="ascii" style="font-family:ui-monospace,monospace; font-size:1.05rem;">Ryazhenka // crew.ecosystem</div>
      <p class="muted">Добро пожаловать в экосистему Ryazhenka: Atmosphere + Hekate + Tesla + плагины + наши утилиты. <strong>Экипаж, стабильность и терминальный визуал.</strong></p>
      <div class="cta">
        <a class="btn primary" href="#install">Установить сейчас</a>
        <a class="btn" href="#changelog">История изменений</a>
        <a class="btn" href="#wiki">Документация / Wiki</a>
        <a class="btn" href="https://github.com/Dimasick-git/Ryzhenka/discussions" target="_blank">Обсуждения</a>
      </div>
    </section>

    <!-- 2. Auto-grid релизов (все релизы автоматически) -->
    <section class="panel" id="changelog">
      <h2 class="glow">История изменений / Релизы</h2>
      <div class="muted">Список всех релизов загружается автоматически из GitHub. Для каждого релиза — логотип, версия, дата, краткое описание и прямые ссылки на сборки.</div>
      <div class="releases" id="releases-list" aria-live="polite"></div>
      <div class="cta">
        <a class="btn" href="https://github.com/Dimasick-git/Ryzhenka/releases" target="_blank">Все релизы на GitHub</a>
      </div>
    </section>

    <!-- 3. Стена экипажа / Благодарности -->
    <section class="panel" id="crew">
      <h2 class="glow">Стена экипажа / Благодарности</h2>
      <p class="muted">Автосбор участников по вкладу (contributors) + ручное добавление ключевых членов экипажа.</p>
      <div class="crew-grid" id="crew-grid"></div>
      <div style="margin-top:.75rem;">
        <small class="muted">Если хотите вручную добавить участника — откройте файл scripts/main.js и отредактируйте секцию manualCrew.</small>
      </div>
    </section>

    <!-- 4. Философский терминальный блок -->
    <section class="panel" id="philosophy">
      <h2 class="glow">Терминальные принципы экипажа</h2>
      <pre class="terminal-block">
/* Ryazhenka — crew philosophy */
- Простота установки и обновления
- Прозрачные релизы и журнал изменений
- Совместимость со всеми Switch homebrew
- Уважение к пользователю и разработчику
- Минимализм, стабильность, контроль
      </pre>
    </section>

    <!-- 5. Цели / дорожная карта -->
    <section class="panel" id="roadmap">
      <h2 class="glow">Цели / Дорожная карта</h2>
      <div class="roadmap" id="roadmap-list">
        <div>• Обновление Ryazhenkabestcfw / Тюнер из консоли</div>
        <div>• Темы для Ryazhahand</div>
        <div>• Полная реорганизация sys-clk</div>
        <div>• Режимы экипажа и быстрый отклик</div>
      </div>
      <div style="margin-top:.5rem;">
        <small class="muted">Автоматически можно подтянуть задачи/issues с меткой <code>roadmap</code> — при желании подключаем.</small>
      </div>
    </section>

    <!-- 6. Руководство по установке -->
    <section class="panel" id="install">
      <h2 class="glow">Установка</h2>
      <ol>
        <li>Скачайте последний релиз из раздела <a href="#changelog">История изменений</a>.</li>
        <li>Распакуйте содержимое на карту microSD, сохраните существующие бэкапы.</li>
        <li>Запустите через Hekate или ваш метод загрузки.</li>
        <li>Откройте Tesla Menu, настройте плагины и оверлеи.</li>
      </ol>
      <div class="cta">
        <a class="btn" href="https://github.com/Dimasick-git/Ryzhenka/wiki" target="_blank">Полная документация / Wiki</a>
      </div>
    </section>

    <!-- 8. Компоненты -->
    <section class="panel" id="components">
      <h2 class="glow">Компоненты</h2>
      <div class="components">
        <a class="comp" href="https://github.com/Dimasick-git/Ryazhahand-Overlay/tree/main" target="_blank">
          <img src="https://raw.githubusercontent.com/Dimasick-git/Ryazhahand-Overlay/main/.pics/Ryazhahand.png" alt="Ryazhahand Overlay" />
          <div>
            <h3>Ryazhahand Overlay</h3>
            <p>Наложение / Overlay — управление и темы.</p>
          </div>
        </a>
        <a class="comp" href="https://github.com/Atmosphere-NX/Atmosphere" target="_blank">
          <img src="https://raw.githubusercontent.com/Atmosphere-NX/Atmosphere/master/docs/assets/logo.png" alt="Atmosphere" />
          <div>
            <h3>Atmosphere</h3>
            <p>Основная CFW-платформа для Switch.</p>
          </div>
        </a>
        <a class="comp" href="https://github.com/CTCaer/hekate" target="_blank">
          <img src="https://raw.githubusercontent.com/CTCaer/hekate/master/docs/logo.png" alt="Hekate" />
          <div>
            <h3>Hekate</h3>
            <p>Загрузчик/менеджер, профили и бэкап NAND.</p>
          </div>
        </a>
        <a class="comp" href="https://github.com/WerWolv/Tesla-Menu" target="_blank">
          <img src="https://raw.githubusercontent.com/WerWolv/Tesla-Menu/master/icon.png" alt="Tesla Menu" />
          <div>
            <h3>Tesla Menu</h3>
            <p>Меню для плагинов и быстрого доступа.</p>
          </div>
        </a>
      </div>
    </section>

    <!-- 7. Документация, обсуждение -->
    <section class="panel" id="wiki">
      <h2 class="glow">Документация и связь</h2>
      <nav class="links">
        <a href="https://github.com/Dimasick-git/Ryzhenka/wiki" target="_blank">Wiki / Руководства</a>
        <a href="https://github.com/Dimasick-git/Ryzhenka/discussions" target="_blank">Обсуждения</a>
        <a href="https://github.com/Dimasick-git/Ryzhenka/issues" target="_blank">Issues / Баг-репорты</a>
        <a href="https://boosty.to/dimasick-git/donate" target="_blank">Поддержать</a>
      </nav>
    </section>
  </main>

  <footer>
    <div class="wrap">
      <div class="badges">
        <a class="badge" href="https://t.me/Ryazhenkabestcfw" target="_blank">Telegram</a>
        <a class="badge" href="https://boosty.to/dimasick-git/donate" target="_blank">Boosty</a>
      </div>
      <div style="margin-top:.5rem;" class="muted">© Ryazhenka — crew.ecosystem</div>
    </div>
  </footer>

  <script>
    // Настройки репозитория
    const owner = 'Dimasick-git';
    const repo = 'Ryzhenka';
    const apiBase = `https://api.github.com/repos/${owner}/${repo}`;
    const releasesApi = `${apiBase}/releases?per_page=100`;
    const contributorsApi = `${apiBase}/contributors?per_page=100`;
    const listEl = document.getElementById('releases-list');
    const crewGrid = document.getElementById('crew-grid');

    // Manual crew overrides / роли (можно редактировать)
    const manualCrew = [
      { login: 'Dimasick-git', name: 'Dimasick-git', role: 'главный разработчик 🚀' },
      { login: 'Kirill-git', name: 'Кирилл-git', role: 'ядро-тестер, идеи 🧪' },
      { login: 'Notler', name: 'Тихомир-гит (нотлер)', role: 'креатив, ревью 🎨' }
    ];

    // Theme toggle with persist
    const themeSwitch = document.getElementById('themeSwitch');
    const doc = document.documentElement;
    function applyTheme(theme) {
      doc.dataset.theme = theme;
      localStorage.setItem('rz_theme', theme);
    }
    (function initTheme() {
      const stored = localStorage.getItem('rz_theme');
      const prefers = stored || doc.dataset.theme || 'glow';
      applyTheme(prefers);
    })();
    document.getElementById('themeToggle')?.addEventListener('click', () => {
      const next = doc.dataset.theme === 'classic' ? 'glow' : 'classic';
      applyTheme(next);
    });

    // Утилиты
    function fmtDate(iso) {
      if(!iso) return '';
      try {
        const d = new Date(iso);
        return d.toLocaleDateString('ru-RU', { year: 'numeric', month: 'short', day: 'numeric' });
      } catch (e) { return iso; }
    }

    function bbootLogoUrl(version) {
      return `https://github.com/${owner}/${repo}/releases/download/${version}/bbootlogo.png`;
    }

    function tagUrl(version) {
      // Ссылка на тег-релиз
      return `https://github.com/${owner}/${repo}/releases/tag/${encodeURIComponent(version)}`;
    }

    // Создание карточки релиза
    function mkCard(r) {
      const card = document.createElement('article');
      card.className = 'release-card';
      const ver = r.tag_name || r.name || '';
      // изображение (попробуем использовать ассет bbootlogo, иначе составной url)
      const img = document.createElement('img');
      img.alt = `Лого ${ver}`;
      img.loading = 'lazy';
      // если среди ассетов есть bbootlogo.png — используем её
      const basset = (r.assets || []).find(a => /bbootlogo/i.test(a.name));
      img.src = basset ? basset.browser_download_url : bbootLogoUrl(ver);
      card.appendChild(img);

      const h3 = document.createElement('h3');
      h3.textContent = r.name || ver;
      card.appendChild(h3);

      const meta = document.createElement('div');
      meta.className = 'meta';
      const date = document.createElement('span');
      date.textContent = fmtDate(r.published_at || r.created_at);
      const vspan = document.createElement('span');
      vspan.textContent = ver;
      meta.append(date, vspan);
      card.appendChild(meta);

      if (r.body) {
        const p = document.createElement('p');
        p.textContent = r.body.length > 300 ? r.body.slice(0, 300) + '…' : r.body;
        card.appendChild(p);
      }

      // Активные сборки / типы (Ryazhenkabestcfw, Ryazhenka_AIO, Ryazhenka_lite)
      const assetsWrap = document.createElement('div');
      assetsWrap.className = 'assets';
      const titles = ['Ryazhenkabestcfw', 'Ryazhenka_AIO', 'Ryazhenka_lite'];
      titles.forEach(t => {
        // пытаемся найти ассет по имени (частичное совпадение)
        const asset = (r.assets || []).find(a => a.name && a.name.toLowerCase().includes(t.toLowerCase()));
        const row = document.createElement('div');
        row.className = 'asset';
        if (asset) {
          const a = document.createElement('a');
          a.href = asset.browser_download_url;
          a.target = '_blank';
          a.textContent = `${t} — ${asset.name}`;
          row.appendChild(a);
          const size = document.createElement('small');
          size.className = 'muted';
          size.style.marginLeft = 'auto';
          size.textContent = asset.size ? `${(asset.size/1024/1024).toFixed(2)} MB` : '';
          row.appendChild(size);
        } else {
          const span = document.createElement('span');
          span.className = 'muted';
          span.textContent = `${t} — отсутствует`;
          row.appendChild(span);
        }
        assetsWrap.appendChild(row);
      });
      // также продолжаем показывать список всех ассетов, если есть
      if ((r.assets || []).length > 0) {
        const more = document.createElement('details');
        more.style.marginTop = '0.5rem';
        const summary = document.createElement('summary');
        summary.textContent = `Все файлы (${r.assets.length})`;
        more.appendChild(summary);
        const list = document.createElement('div');
        (r.assets || []).forEach(a => {
          const line = document.createElement('div');
          line.className = 'asset';
          const link = document.createElement('a');
          link.href = a.browser_download_url;
          link.target = '_blank';
          link.textContent = a.name;
          line.appendChild(link);
          const small = document.createElement('small');
          small.className = 'muted';
          small.style.marginLeft = 'auto';
          small.textContent = a.size ? `${(a.size/1024/1024).toFixed(2)} MB` : '';
          line.appendChild(small);
          list.appendChild(line);
        });
        more.appendChild(list);
        assetsWrap.appendChild(more);
      }

      card.appendChild(assetsWrap);

      // Ссылки
      const btnWrap = document.createElement('div');
      btnWrap.style.display = 'flex';
      btnWrap.style.gap = '.5rem';
      btnWrap.style.marginTop = '.5rem';
      const openRel = document.createElement('a');
      openRel.className = 'btn';
      openRel.href = tagUrl(ver);
      openRel.target = '_blank';
      openRel.textContent = 'Открыть релиз';
      btnWrap.appendChild(openRel);
      if (r.html_url) {
        const openGH = document.createElement('a');
        openGH.className = 'btn';
        openGH.href = r.html_url;
        openGH.target = '_blank';
        openGH.textContent = 'GitHub';
        btnWrap.appendChild(openGH);
      }
      card.appendChild(btnWrap);

      return card;
    }

    // Загрузка всех релизов
    async function loadReleases() {
      try {
        listEl.innerHTML = '<p class="muted">Загрузка релизов…</p>';
        const res = await fetch(releasesApi);
        if (!res.ok) throw new Error('Ошибка загрузки релизов');
        const data = await res.json();
        listEl.innerHTML = '';
        // Сортируем по published_at desc
        data.sort((a,b) => new Date(b.published_at || b.created_at) - new Date(a.published_at || a.created_at));
        data.forEach(r => {
          const card = mkCard(r);
          listEl.appendChild(card);
        });
        if (data.length === 0) {
          listEl.innerHTML = '<p class="muted">Релизов не найдено.</p>';
        }
      } catch (e) {
        listEl.innerHTML = '<p class="muted">Не удалось загрузить релизы. Попробуйте позже.</p>';
        console.error(e);
      }
    }

    // Стена экипажа: подгружаем contributors и объединяем с manualCrew
    async function loadCrew() {
      try {
        crewGrid.innerHTML = '<p class="muted">Загрузка участников…</p>';
        const res = await fetch(contributorsApi);
        if (!res.ok) throw new Error('Ошибка загрузки участников');
        const contributors = await res.json();
        // Сопоставляем manualCrew по login и добавляем роль, если есть
        const manualMap = new Map(manualCrew.map(m => [m.login.toLowerCase(), m]));
        const people = contributors.map(c => {
          const login = c.login;
          const mm = manualMap.get(login.toLowerCase());
          return {
            login,
            avatar: c.avatar_url,
            contributions: c.contributions,
            role: mm ? mm.role : ''
          };
        });

        // добавим вручную членов экипажа, если их нет в списке contributors
        manualCrew.forEach(m => {
          if (!people.find(p => p.login.toLowerCase() === m.login.toLowerCase())) {
            people.unshift({
              login: m.login,
              avatar: `https://github.com/${m.login}.png`,
              contributions: 0,
              role: m.role || ''
            });
          }
        });

        crewGrid.innerHTML = '';
        people.forEach(p => {
          const card = document.createElement('div');
          card.className = 'crew-card';
          const img = document.createElement('img');
          img.src = p.avatar;
          img.alt = p.login;
          card.appendChild(img);
          const info = document.createElement('div');
          const name = document.createElement('div');
          const link = document.createElement('a');
          link.href = `https://github.com/${p.login}`;
          link.target = '_blank';
          link.textContent = p.login;
          name.appendChild(link);
          if (p.role) {
            const role = document.createElement('div');
            role.className = 'muted';
            role.textContent = p.role;
            role.style.fontSize = '.9rem';
            info.appendChild(role);
          }
          const contrib = document.createElement('div');
          contrib.className = 'muted';
          contrib.style.fontSize = '.85rem';
          contrib.textContent = `Commits: ${p.contributions || 0}`;
          info.appendChild(name);
          info.appendChild(contrib);
          card.appendChild(info);
          crewGrid.appendChild(card);
        });

      } catch (e) {
        crewGrid.innerHTML = '<p class="muted">Не удалось загрузить участников.</p>';
        console.error(e);
      }
    }

    // При загрузке страницы
    (function init() {
      loadReleases();
      loadCrew();
    })();

    // Для разработки: expose some functions to window
    window.RZ = { loadReleases, loadCrew, manualCrew };

  </script>
</body>
</html>